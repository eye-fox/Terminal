name: Remote Shell Pro

on:
  workflow_dispatch:
    inputs:
      command:
        description: "Command to execute"
        required: true

jobs:
  execute:
    runs-on: ubuntu-latest

    steps:
      - name: Restore State
        run: |
          if [ -f .gh_state ]; then
            echo "State exists"
          else
            echo "$HOME" > .gh_state
          fi

      - name: Run Persistent Command
        run: |
          echo "===OUTPUT_START==="
          CURRENT_DIR=$(cat .gh_state 2>/dev/null || echo $HOME)
          cd "$CURRENT_DIR"

          bash -c "${{ github.event.inputs.command }}"

          pwd > .gh_state
          echo "===OUTPUT_END==="

      - name: Upload State
        uses: actions/upload-artifact@v4
        with:
          name: gh_state
          path: .gh_state
